<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Device Details - {{ device.device_name }} | IoT Asset Inventory
    </title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --accent-color: #e74c3c;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --info-color: #2980b9;
        --critical-color: #dc3545;
        --high-color: #fd7e14;
        --medium-color: #ffc107;
        --low-color: #20c997;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .nav-tabs .nav-link {
        border: none;
        color: #495057;
        font-weight: 500;
        padding: 12px 20px;
      }

      .nav-tabs .nav-link.active {
        background: rgba(52, 152, 219, 0.1);
        border-bottom: 3px solid var(--secondary-color);
        color: var(--secondary-color);
      }

      .risk-meter {
        height: 20px;
        border-radius: 10px;
        background: #e9ecef;
        overflow: hidden;
        position: relative;
      }

      .risk-meter-fill {
        height: 100%;
        transition: width 0.5s ease;
        position: relative;
      }

      .risk-meter-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      .risk-badge {
        font-size: 0.8em;
        font-weight: bold;
        padding: 6px 12px;
        border-radius: 15px;
      }

      .risk-critical-badge {
        background-color: var(--critical-color);
        color: white;
      }
      .risk-high-badge {
        background-color: var(--high-color);
        color: white;
      }
      .risk-medium-badge {
        background-color: var(--medium-color);
        color: black;
      }
      .risk-low-badge {
        background-color: var(--low-color);
        color: white;
      }

      .protocol-badge {
        font-size: 0.75em;
        margin: 2px;
      }

      .cve-item {
        border-left: 4px solid #dc3545;
        transition: all 0.3s ease;
      }

      .cve-item:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .service-item {
        border-left: 4px solid #28a745;
      }

      .port-item {
        border-left: 4px solid #17a2b8;
      }

      .timeline {
        position: relative;
        padding-left: 30px;
      }

      .timeline::before {
        content: "";
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #e9ecef;
      }

      .timeline-item {
        position: relative;
        margin-bottom: 20px;
      }

      .timeline-item::before {
        content: "";
        position: absolute;
        left: -23px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--secondary-color);
        border: 2px solid white;
      }

      .factor-meter {
        height: 8px;
        border-radius: 4px;
        background: #e9ecef;
        overflow: hidden;
        margin-top: 5px;
      }

      .factor-fill {
        height: 100%;
        transition: width 0.5s ease;
      }

      .recommendation-card {
        border-left: 4px solid var(--warning-color);
        transition: all 0.3s ease;
      }

      .recommendation-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }

      .communication-flow {
        height: 300px;
        background: #f8f9fa;
        border-radius: 8px;
        position: relative;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .stat-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: 12px;
        overflow: hidden;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
      }
    </style>
  </head>
  <body>
    <div class="container-fluid py-4">
      <!-- Back Navigation -->
      <div class="row mb-4">
        <div class="col-12">
          <a href="/identify" class="btn btn-outline-light">
            <i class="fas fa-arrow-left me-2"></i>Back to Device List
          </a>
        </div>
      </div>

      <!-- Device Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="glass-card p-4">
            <div class="row align-items-center">
              <div class="col-md-8">
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <i class="fas fa-microchip fa-3x text-primary"></i>
                  </div>
                  <div>
                    <h1 class="h3 mb-1">{{ device.device_name }}</h1>
                    <p class="text-muted mb-2">
                      <strong>MAC:</strong>
                      <code>{{ device.mac_address }}</code> |
                      <strong>IP:</strong> {{ device.ip_address }} |
                      <strong>Type:</strong> {{ device.device_type }}
                    </p>
                    <div class="d-flex flex-wrap gap-2">
                      <span class="badge bg-secondary"
                        >{{ device.manufacturer }}</span
                      >
                      {% if device.device_model %}
                      <span class="badge bg-info"
                        >{{ device.device_model }}</span
                      >
                      {% endif %}
                      <span
                        class="badge {% if device.status == 'Active' %}bg-success{% else %}bg-warning{% endif %}"
                      >
                        {{ device.status }}
                      </span>
                      {% if device.is_quarantined %}
                      <span class="badge bg-danger">Quarantined</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4 text-end">
                <div class="d-flex flex-column align-items-end">
                  <div class="mb-3">
                    <span
                      class="risk-badge risk-{{ device.risk_level }}-badge me-2"
                    >
                      Risk Score: {{ device.risk_score }}/1000
                    </span>
                    <span class="badge bg-danger">
                      {{ device.cves|length }} CVEs
                    </span>
                  </div>
                  <div class="risk-meter mb-2" style="width: 200px">
                    <div
                      class="risk-meter-fill bg-{{ device.risk_level }}"
                      style="width: {{ device.risk_score / 10 }}%"
                    ></div>
                  </div>
                  <div class="btn-group">
                    <button
                      class="btn btn-outline-warning"
                      onclick="analyzeDevice('{{ device.mac_address }}')"
                    >
                      <i class="fas fa-chart-bar me-1"></i>Re-analyze
                    </button>
                    {% if not device.is_quarantined %}
                    <button
                      class="btn btn-outline-danger"
                      onclick="quarantineDevice('{{ device.mac_address }}')"
                    >
                      <i class="fas fa-shield-alt me-1"></i>Quarantine
                    </button>
                    {% else %}
                    <button
                      class="btn btn-outline-success"
                      onclick="releaseDevice('{{ device.mac_address }}')"
                    >
                      <i class="fas fa-unlock me-1"></i>Release
                    </button>
                    {% endif %}
                    <button
                      class="btn btn-outline-info"
                      onclick="exportDeviceReport('{{ device.mac_address }}')"
                    >
                      <i class="fas fa-download me-1"></i>Export
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="row mb-4">
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">{{ device.open_ports|length }}</h4>
              <small>Open Ports</small>
            </div>
          </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">{{ device.protocols|length }}</h4>
              <small>Protocols</small>
            </div>
          </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">{{ device.services|length }}</h4>
              <small>Services</small>
            </div>
          </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">{{ device.communication_partners|length }}</h4>
              <small>Connections</small>
            </div>
          </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">
                {{ (device.data_usage.in + device.data_usage.out)|filesizeformat
                if device.data_usage else '0' }}
              </h4>
              <small>Data Usage</small>
            </div>
          </div>
        </div>
        <div class="col-xl-2 col-md-4 mb-3">
          <div
            class="stat-card text-white"
            style="
              background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            "
          >
            <div class="card-body text-center">
              <h4 class="mb-1">{{ device.tags|length }}</h4>
              <small>Tags</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Tabs -->
      <div class="row">
        <div class="col-12">
          <div class="glass-card">
            <div class="card-body">
              <ul class="nav nav-tabs mb-4" id="deviceTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link active"
                    id="overview-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#overview"
                    type="button"
                    role="tab"
                  >
                    <i class="fas fa-info-circle me-2"></i>Overview
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="vulnerabilities-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#vulnerabilities"
                    type="button"
                    role="tab"
                  >
                    <i class="fas fa-bug me-2"></i>Vulnerabilities {% if
                    device.cves and device.cves|length > 0 %}
                    <span class="badge bg-danger ms-1"
                      >{{ device.cves|length }}</span
                    >
                    {% endif %}
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="network-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#network"
                    type="button"
                    role="tab"
                  >
                    <i class="fas fa-network-wired me-2"></i>Network Activity
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="risk-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#risk"
                    type="button"
                    role="tab"
                  >
                    <i class="fas fa-chart-line me-2"></i>Risk Analysis
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button
                    class="nav-link"
                    id="configuration-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#configuration"
                    type="button"
                    role="tab"
                  >
                    <i class="fas fa-cog me-2"></i>Configuration
                  </button>
                </li>
              </ul>

              <div class="tab-content" id="deviceTabsContent">
                <!-- Overview Tab -->
                <div
                  class="tab-pane fade show active"
                  id="overview"
                  role="tabpanel"
                >
                  <div class="row">
                    <div class="col-md-6">
                      <div class="glass-card p-4 mb-4">
                        <h5 class="mb-3">
                          <i class="fas fa-info-circle text-primary me-2"></i
                          >Basic Information
                        </h5>
                        <div class="row">
                          <div class="col-6 mb-2">
                            <strong>Device Name:</strong>
                          </div>
                          <div class="col-6 mb-2">{{ device.device_name }}</div>

                          <div class="col-6 mb-2">
                            <strong>MAC Address:</strong>
                          </div>
                          <div class="col-6 mb-2">
                            <code>{{ device.mac_address }}</code>
                          </div>

                          <div class="col-6 mb-2">
                            <strong>IP Address:</strong>
                          </div>
                          <div class="col-6 mb-2">{{ device.ip_address }}</div>

                          <div class="col-6 mb-2">
                            <strong>Manufacturer:</strong>
                          </div>
                          <div class="col-6 mb-2">
                            {{ device.manufacturer }}
                          </div>

                          <div class="col-6 mb-2">
                            <strong>Device Type:</strong>
                          </div>
                          <div class="col-6 mb-2">{{ device.device_type }}</div>

                          <div class="col-6 mb-2"><strong>Model:</strong></div>
                          <div class="col-6 mb-2">
                            {{ device.device_model or 'Unknown' }}
                          </div>

                          <div class="col-6 mb-2">
                            <strong>Firmware:</strong>
                          </div>
                          <div class="col-6 mb-2">
                            {{ device.firmware_version or 'Unknown' }}
                          </div>

                          <div class="col-6 mb-2">
                            <strong>OS Version:</strong>
                          </div>
                          <div class="col-6 mb-2">
                            {{ device.os_version or 'Unknown' }}
                          </div>
                        </div>
                      </div>

                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i class="fas fa-history text-info me-2"></i>Timeline
                        </h5>
                        <div class="timeline">
                          <div class="timeline-item">
                            <strong>First Seen</strong><br />
                            <small class="text-muted"
                              >{{ device.first_seen }}</small
                            >
                          </div>
                          <div class="timeline-item">
                            <strong>Last Seen</strong><br />
                            <small class="text-muted"
                              >{{ device.last_seen }}</small
                            >
                          </div>
                          {% if device.last_risk_assessment %}
                          <div class="timeline-item">
                            <strong>Last Risk Assessment</strong><br />
                            <small class="text-muted"
                              >{{ device.last_risk_assessment }}</small
                            >
                          </div>
                          {% endif %}
                        </div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="glass-card p-4 mb-4">
                        <h5 class="mb-3">
                          <i class="fas fa-plug text-warning me-2"></i>Services
                          & Protocols
                        </h5>

                        <h6 class="mt-3 mb-2">Protocols</h6>
                        <div class="mb-3">
                          {% for protocol in device.protocols %}
                          <span class="badge bg-primary protocol-badge"
                            >{{ protocol }}</span
                          >
                          {% endfor %}
                        </div>

                        <h6 class="mt-3 mb-2">Open Ports</h6>
                        <div class="mb-3">
                          {% for port in device.open_ports %}
                          <span class="badge bg-warning protocol-badge"
                            >Port {{ port }}</span
                          >
                          {% endfor %}
                        </div>

                        <h6 class="mt-3 mb-2">Services</h6>
                        <div>
                          {% for service in device.services %}
                          <span class="badge bg-success protocol-badge"
                            >{{ service }}</span
                          >
                          {% endfor %}
                        </div>
                      </div>

                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i class="fas fa-tags text-success me-2"></i>Tags &
                          Metadata
                        </h5>
                        <div class="mb-3">
                          {% for tag in device.tags %}
                          <span class="badge bg-secondary me-1">{{ tag }}</span>
                          {% endfor %}
                        </div>

                        {% if device.dhcp_fingerprint %}
                        <h6 class="mt-3 mb-2">DHCP Fingerprint</h6>
                        <code class="small">{{ device.dhcp_fingerprint }}</code>
                        {% endif %} {% if device.mdns_services %}
                        <h6 class="mt-3 mb-2">mDNS Services</h6>
                        <div>
                          {% for service in device.mdns_services %}
                          <span class="badge bg-info protocol-badge"
                            >{{ service }}</span
                          >
                          {% endfor %}
                        </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Vulnerabilities Tab -->
                <div class="tab-pane fade" id="vulnerabilities" role="tabpanel">
                  {% if device.cves and device.cves|length > 0 %}
                  <div class="row">
                    <div class="col-12">
                      <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        This device has {{ device.cves|length }} known
                        vulnerabilities. Immediate action recommended.
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    {% for cve in device.cves %}
                    <div class="col-lg-6 mb-3">
                      <div class="glass-card p-3 cve-item">
                        <div
                          class="d-flex justify-content-between align-items-start mb-2"
                        >
                          <h6 class="mb-0 text-danger">{{ cve.cve_id }}</h6>
                          <span
                            class="badge {% if cve.severity == 'CRITICAL' %}bg-danger{% elif cve.severity == 'HIGH' %}bg-warning{% elif cve.severity == 'MEDIUM' %}bg-info{% else %}bg-secondary{% endif %}"
                          >
                            {{ cve.severity }}
                          </span>
                        </div>
                        <p class="small mb-2">{{ cve.description }}</p>
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <small class="text-muted"
                            >CVSS: {{ cve.cvss_score }}</small
                          >
                          <small class="text-muted"
                            >Published: {{ cve.published_date[:10] }}</small
                          >
                        </div>
                        {% if cve.references %}
                        <div class="mt-2">
                          <button
                            class="btn btn-sm btn-outline-primary"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#refs{{ loop.index }}"
                          >
                            References
                          </button>
                          <div class="collapse mt-2" id="refs{{ loop.index }}">
                            {% for ref in cve.references[:3] %}
                            <div class="small">
                              <a
                                href="{{ ref }}"
                                target="_blank"
                                class="text-break"
                                >{{ ref[:80] }}...</a
                              >
                            </div>
                            {% endfor %}
                          </div>
                        </div>
                        {% endif %}
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                  {% else %}
                  <div class="text-center py-5">
                    <i class="fas fa-shield-check fa-4x text-success mb-3"></i>
                    <h5 class="text-success">No Known Vulnerabilities</h5>
                    <p class="text-muted">
                      No CVEs found for this device based on current analysis.
                    </p>
                  </div>
                  {% endif %}
                </div>

                <!-- Network Activity Tab -->
                <div class="tab-pane fade" id="network" role="tabpanel">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="glass-card p-4 mb-4">
                        <h5 class="mb-3">
                          <i class="fas fa-exchange-alt text-primary me-2"></i
                          >Communication Partners
                        </h5>
                        {% if device.communication_partners and
                        device.communication_partners|length > 0 %}
                        <div class="list-group">
                          {% for partner in device.communication_partners[:10]
                          %}
                          <div
                            class="list-group-item d-flex justify-content-between align-items-center"
                          >
                            <code>{{ partner }}</code>
                            <span class="badge bg-primary rounded-pill"
                              >Active</span
                            >
                          </div>
                          {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted">
                          No communication partners recorded.
                        </p>
                        {% endif %}
                      </div>

                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i class="fas fa-chart-bar text-info me-2"></i>Data
                          Usage
                        </h5>
                        {% if device.data_usage %}
                        <div class="row text-center">
                          <div class="col-6">
                            <h4 class="text-primary">
                              {{ device.data_usage.in|filesizeformat }}
                            </h4>
                            <small class="text-muted">Data In</small>
                          </div>
                          <div class="col-6">
                            <h4 class="text-success">
                              {{ device.data_usage.out|filesizeformat }}
                            </h4>
                            <small class="text-muted">Data Out</small>
                          </div>
                        </div>
                        {% else %}
                        <p class="text-muted">
                          No data usage statistics available.
                        </p>
                        {% endif %}
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i
                            class="fas fa-project-diagram text-warning me-2"
                          ></i
                          >Network Map
                        </h5>
                        <div
                          class="communication-flow d-flex align-items-center justify-content-center"
                        >
                          <div class="text-center">
                            <i
                              class="fas fa-network-wired fa-3x text-muted mb-3"
                            ></i>
                            <p class="text-muted">
                              Network visualization would appear here
                            </p>
                            <small class="text-muted"
                              >Showing connections and data flow patterns</small
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Risk Analysis Tab -->
                <div class="tab-pane fade" id="risk" role="tabpanel">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="glass-card p-4 mb-4">
                        <h5 class="mb-3">
                          <i class="fas fa-chart-pie text-danger me-2"></i>Risk
                          Factors
                        </h5>
                        {% if device.risk_factors %} {% for factor in
                        device.risk_factors %}
                        <div class="mb-3">
                          <div
                            class="d-flex justify-content-between align-items-center mb-1"
                          >
                            <span class="small">{{ factor.name }}</span>
                            <span class="small text-muted"
                              >{{ (factor.value * 100)|round(1) }}%</span
                            >
                          </div>
                          <div class="factor-meter">
                            <div
                              class="factor-fill bg-{{ device.risk_level }}"
                              style="width: {{ factor.value * 100 }}%"
                            ></div>
                          </div>
                          <small class="text-muted"
                            >{{ factor.description }}</small
                          >
                        </div>
                        {% endfor %} {% else %}
                        <p class="text-muted">
                          No detailed risk factors available.
                        </p>
                        {% endif %}
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i class="fas fa-lightbulb text-warning me-2"></i
                          >Security Recommendations
                        </h5>
                        {% if device.recommendations %} {% for recommendation in
                        device.recommendations %}
                        <div class="recommendation-card p-3 mb-3">
                          <div class="d-flex">
                            <i
                              class="fas fa-check-circle text-success me-3 mt-1"
                            ></i>
                            <div>
                              <h6 class="mb-1">{{ recommendation.title }}</h6>
                              <p class="small mb-0 text-muted">
                                {{ recommendation.description }}
                              </p>
                              {% if recommendation.priority %}
                              <span
                                class="badge {% if recommendation.priority == 'High' %}bg-danger{% elif recommendation.priority == 'Medium' %}bg-warning{% else %}bg-info{% endif %} mt-2"
                              >
                                {{ recommendation.priority }} Priority
                              </span>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                        {% endfor %} {% else %}
                        <div class="text-center py-3">
                          <i
                            class="fas fa-thumbs-up fa-2x text-success mb-2"
                          ></i>
                          <p class="text-muted">
                            No specific recommendations at this time.
                          </p>
                        </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Configuration Tab -->
                <div class="tab-pane fade" id="configuration" role="tabpanel">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="glass-card p-4 mb-4">
                        <h5 class="mb-3">
                          <i class="fas fa-code text-secondary me-2"></i>Raw
                          Device Data
                        </h5>
                        <pre
                          class="bg-light p-3 rounded small"
                          style="max-height: 400px; overflow: auto"
                        ><code>{{ device|tojson(indent=2) }}</code></pre>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="glass-card p-4">
                        <h5 class="mb-3">
                          <i class="fas fa-tools text-info me-2"></i>Device
                          Actions
                        </h5>
                        <div class="d-grid gap-2">
                          <button
                            class="btn btn-outline-warning"
                            onclick="analyzeDevice('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-chart-bar me-2"></i>Re-analyze
                            Device
                          </button>
                          <button
                            class="btn btn-outline-info"
                            onclick="scanServices('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-search me-2"></i>Scan Services
                          </button>
                          <button
                            class="btn btn-outline-secondary"
                            onclick="updateFirmwareInfo('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-sync me-2"></i>Check Firmware
                            Updates
                          </button>
                          {% if not device.is_quarantined %}
                          <button
                            class="btn btn-outline-danger"
                            onclick="quarantineDevice('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-shield-alt me-2"></i>Quarantine
                            Device
                          </button>
                          {% else %}
                          <button
                            class="btn btn-outline-success"
                            onclick="releaseDevice('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-unlock me-2"></i>Release from
                            Quarantine
                          </button>
                          {% endif %}
                          <button
                            class="btn btn-outline-dark"
                            onclick="deleteDevice('{{ device.mac_address }}')"
                          >
                            <i class="fas fa-trash me-2"></i>Delete Device
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function analyzeDevice(macAddress) {
        if (
          confirm(
            "Re-analyze this device? This will update risk scores and vulnerability information."
          )
        ) {
          fetch(`/identify/device/${macAddress}/analyze`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Device analysis completed!");
                location.reload();
              } else {
                alert("Analysis failed: " + data.message);
              }
            })
            .catch((error) => {
              console.error("Analysis failed:", error);
              alert("Device analysis failed");
            });
        }
      }

      function quarantineDevice(macAddress) {
        if (
          confirm(
            "Quarantine this device? This will isolate it from the network."
          )
        ) {
          fetch(`/identify/device/${macAddress}/quarantine`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert("Device quarantined successfully!");
                location.reload();
              } else {
                alert("Quarantine failed: " + data.message);
              }
            })
            .catch((error) => {
              console.error("Quarantine failed:", error);
              alert("Device quarantine failed");
            });
        }
      }

      function releaseDevice(macAddress) {
        fetch(`/identify/device/${macAddress}/release`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("Device released successfully!");
              location.reload();
            } else {
              alert("Release failed: " + data.message);
            }
          })
          .catch((error) => {
            console.error("Release failed:", error);
            alert("Device release failed");
          });
      }

      function deleteDevice(macAddress) {
        if (
          confirm(
            "Are you sure you want to delete this device? This action cannot be undone."
          )
        ) {
          fetch(`/identify/device/${macAddress}`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              alert(data.message);
              if (data.success) {
                window.location.href = "/identify";
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("Failed to delete device");
            });
        }
      }

      function scanServices(macAddress) {
        alert("Service scanning feature would be implemented here");
      }

      function updateFirmwareInfo(macAddress) {
        alert("Firmware update check would be implemented here");
      }

      function exportDeviceReport(macAddress) {
        window.location.href = `/identify/device/${macAddress}/export`;
      }

      // Initialize tab functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Activate the first tab
        const firstTab = new bootstrap.Tab(
          document.getElementById("overview-tab")
        );
        firstTab.show();
      });
    </script>
  </body>
</html>
